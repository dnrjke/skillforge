# CLAUDE.md – 매핑 및 좌표 처리 가이드라인

## 1. 기본 원칙
- **이전 코드 우선 원칙**  
  변환이나 리팩토링 과정에서 직관과 어긋나는 매핑이 발생할 경우, 반드시 이전 브랜치(JS)의 매핑 테이블을 그대로 유지한다.  
  새로 해석하거나 임의로 오름차순 정렬하지 않는다.

- **사용자 알림 의무**  
  기존 코드와 새 매핑 규칙이 충돌할 경우, 즉시 사용자에게 알리고 선택지를 요청한다.  
  예시:  
⚠️ 기존 코드와 매핑 규칙이 충돌합니다.

이전 코드: units[1] → pos=4

새 해석: units[1] → pos=2
어떤 기준을 따를까요?

코드

## 2. 좌표 매핑 규칙
- **전장 좌표(World X)**와 **UI 좌표(Screen Left)**는 반드시 일관된 기준으로 정렬한다.
- 오름차순 정렬을 적용할 경우, **한쪽 체계에만** 적용한다.  
- 전장 좌표 기준: X좌표 오름차순 → UI 좌표도 같은 순서로 배치  
- UI 슬롯 번호 기준: 슬롯 번호 오름차순 → 전장 좌표도 그에 맞게 재배치
- 두 체계를 혼합하여 오름차순을 적용하지 않는다.

## 3. 매핑 테이블 (BattleScene.ts)
아래 매핑은 **절대 변경하지 않는다**.  
모든 UI 업데이트 로직은 이 테이블을 기준으로 동작해야 한다.

units[0] (후열, x:150) → pos=1 (left:98px)
units[1] (중열, x:260) → pos=4 (left:116px)
units[2] (전열, x:400) → pos=2 (left:141px)

코드

## 4. 검증 절차
- 변환 시, 전장 좌표와 UI 좌표를 비교하여 불일치가 있는지 자동 검증한다.
- 불일치가 감지되면:
  1. 이전 코드 매핑을 유지한다.
  2. 사용자에게 알린다.
  3. 절대 임의로 수정하지 않는다.

## 5. 요약
- 오름차순 강박 금지.
- 직관과 어긋나면 이전 코드 유지.
- 충돌 시 반드시 사용자에게 알림.
- 매핑 테이블을 주석으로 박아두고 모든 로직에서 준수.