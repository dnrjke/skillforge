# Skyline Blue: Arcana Vector — Development Constitution

> **이 게임은 플레이하는 게임이 아니라, 내가 만든 '논리'가 날아가는 걸 구경하는 게임이다.**

Skyline Blue는 '잘 만드는 게임'이 아니라 '설계하고 감상하는 게임'을 만든다.

---

## 프로젝트 정의 (Project Definition)

> **이 프로젝트는 Babylon.js를 기반으로 하는 2.5D 세로 뷰 모바일 비행 시뮬레이션 게임입니다.**

핵심 콘셉트는 **'에어스포츠부의 청춘과 정령/아르카나의 신비가 결합된 독특한 세계관'**입니다.

### 시각적 참조
- **블루 아카이브**: 청량하고 깔끔한 UI
- **붕괴: 스타레일**: 세련된 SF/판타지 이펙트 및 홀로그램 UI 요소

### Babylon.js 활용 범위
Babylon.js는 단순한 3D 렌더링을 넘어, 게임의 **모든 UI 요소**(노드, 항로, 오버레이, 버튼)에 공간감과 동적인 이펙트를 부여하는 핵심 엔진으로 활용됩니다.

- **항로 설정 파트**: Babylon.js 환경 내에서 2D처럼 보이는 3D GUI로 구현
- **노드 연결 시각화**: LineMesh/TrailMesh를 활용한 빛 흐름 애니메이션
- **UI 오버레이**: AdvancedDynamicTexture를 활용한 3D 씬 위 2D 레이어

### 게임 플로우
1. 플레이어는 노드를 연결하여 **항로를 설정**
2. 이 항로를 따라 미소녀 캐릭터가 비행하는 모습을 **백뷰로 감상**
3. **다익스트라 알고리즘** 기반의 최적 경로 탐색 요소가 게임의 깊이를 더함

### 아키텍처 원칙: Logic/View 분리

```
┌─────────────────────────────────────────┐
│  Logic Layer (TypeScript)               │
│  - 노드 연결 데이터 관리                  │
│  - 다익스트라 계산                        │
│  - 등급 판정                             │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│  View Layer (Babylon.js)                │
│  - 노드 하이라이트 디자인                 │
│  - 항로 연결 라인 렌더링                  │
│  - 사출 버튼 애니메이션                   │
│  - AdvancedDynamicTexture UI            │
└─────────────────────────────────────────┘
```

### 좌표계 방향
- **세로 모드 모바일 화면비 우선**
- 화면 6시(하단) → 12시(상단) 방향으로 진행
- 시작점(하단) → 경유지 → 도착점(상단)

---

## 0. 프로토타입 원칙 (Prototype First)

초기 목표는 **"플레이 가능한 연출"**이다.

재미 검증 전까지 다음 요소는 구현하지 않는다:
- 네트워크 / PVP ❌
- 계정 / 로그인 ❌
- 영구 저장 / DB ❌

모든 시스템은 교체 가능함을 전제로 작성한다.

**"완성도"보다 확장 가능성과 폐기 용이성을 우선한다.**

---

## ★ CORE SCENE: 흡혈귀 에이스의 진심 비행

> **이 조항은 Skyline Blue 전체 개발의 최우선 기준이다.**
> 아래 장면이 실패하면, 다른 모든 시스템은 성공해도 무의미하다.

### 프로토타입 성공 조건 (단 하나)

**"흡혈귀 에이스의 진심 비행" 장면이 스킵 성향의 플레이어조차 끝까지 보게 만든다.**

- 이 장면이 지루하면 → 프로젝트 실패
- 이 장면이 기억에 남으면 → 프로젝트 성립

튜토리얼, 전투, 성장, 밸런스는 전부 부차적이다.

### 이 장면이 담당하는 역할

이 컷신 하나로 다음을 **설명 없이** 전달해야 한다:

- 플레이어는 직접 조종하지 않는다
- 비행은 "설계 + 코칭"의 결과물이다
- 캐릭터마다 비행의 성격과 격이 다르다
- "진심 상태"는 수치가 아니라 연출로 구분된다

**텍스트로 설명하지 않는다. 비행 그 자체가 설명이다.**

### 연출 필수 규칙

#### 조작 완전 금지
- 입력 불가
- UI 전부 숨김
- 안내 텍스트 최소화

→ **30초 이상 손에서 기기를 놓게 만드는 장면이어야 한다.**

#### 연출 구조 (고정)

| 단계 | 내용 |
|------|------|
| 낮 / 엉성한 비행 | 궤적 불안정, 불필요한 동작 많음, 바람 소리 큼 |
| 착지 후 정적 | BGM 없음, 짧은 침묵 (의도적 공백) |
| 해 질 녘 / 분위기 전환 | 색온도 변화, 카메라 거리 확장, 시간의 흐름 체감 |
| 진심 비행 | 궤적이 '문장'처럼 느껴짐, 불필요한 동작 제거, 조용하지만 속도감 |

### 속도와 화려함에 대한 원칙

- 빠를 필요 없다
- 화려할 필요도 없다

**반드시 있어야 할 것:**
- 방향 전환이 "결단"처럼 보일 것
- 궤적이 망설이지 않는다
- 보는 순간 격차가 느껴진다

이 장면에서 플레이어가 이해해야 할 감정은 하나다:

> **"아… 이건 내가 조종하는 게임이 아니구나."**

### 개발 판단 질문 (의무)

모든 구현 전, 다음 질문을 던진다:

❓ **이 요소가 '흡혈귀의 진심 비행'을 더 멋지게 만드는가?**

- YES → 구현
- NO → 보류 또는 삭제

| 요소 | 판정 |
|------|------|
| 물리 정확도 | ❌ 필수 아님 |
| 궤적 보간 | ✔ |
| 카메라 이징 | ✔ |
| 음향 잔향 | ✔ |
| 연출용 시간 왜곡 | ✔ |

### 프로토타입 검증 체크리스트

해당 장면은 아래 조건 중 **최소 4개 이상**을 만족해야 한다:

- [ ] 모바일 세로 화면에서도 몰입이 깨지지 않는다
- [ ] UI 없이도 상황이 전달된다
- [ ] 사운드 없이도 "진심"이 느껴진다
- [ ] 사운드가 있으면 감정이 배가된다
- [ ] 다시 보고 싶다

### 결론

> **이 게임은 플레이하게 만들기 전에, 먼저 감상하게 만들어야 한다.**

흡혈귀 에이스의 비행은 Skyline Blue가 어떤 게임인지에 대한 **유일한 시각적 선언**이다.

---

## 1. 게임 컨셉 (Core Concept)

**"설계하고 감상하는 활공 스포츠"**

- **장르:** 미소녀 활공 스포츠 매니지먼트 (Tactical Flight Sport)
- **플레이어 역할:** 코치 (Coach). 선수들의 비행 궤적과 스킬 타이밍을 '설계'함.

플레이어는 조종사가 아니라 **코치(Coach)**다.

직접 조작보다:
- 비행 조건
- 키워드
- 행동 논리

를 설계하고 결과를 감상한다.

**자동화는 치트가 아니라 클리어 조건이다.**

---

## 2. 비주얼 & 연출 철학

**연출은 게임의 보상이다.**

- 실패(추락, 퇴장)도 감상 가능한 이벤트로 취급한다.
- 컷인은 "정보 전달"이 아니라 감정 증폭 장치다.

**참고 감성:**
- 사키(Saki)식 과장 연출
- 우마무스메 컷신
- 니케 / 블루아카이브의 모바일 감성

**에이스 연출:**
특정 조건(시간대, 게이지)에 따라 동일 유닛의 비행 스타일 및 시각 이펙트가 변함
- 낮: 엉성함 → 밤: 압도적

---

## 3. 레이어 아키텍처 (Layer Architecture)

Skyline Blue는 **3단 레이어 구조**를 사용한다.

### Layer 0 — World (Canvas)
- 실제 게임 월드
- 비행, 발판, 충돌, 이펙트
- 항상 고정 비율 유지

### Layer 1 — Display
- 연출 전용 HTML 레이어
- 컷신, 천사상, 시나리오 텍스트
- 기본적으로 `pointer-events: none`

### Layer 2 — System
- 설정, 디버그, 메뉴 UI
- 모달 동작 시 하위 레이어 입력 차단

**씬 구성:**
- 시나리오 씬 (HTML/GIF 기반 비주얼 노벨)
- 비행/전투 씬 (Canvas 기반 활공 액션 감상)

---

## 4. Adaptive Layout Policy (Mobile / Tablet)

Skyline Blue는 **반응형(Responsive)이 아닌 적응형(Adaptive) 레이아웃**을 사용한다.

### 디바이스 분류
- **Mobile:** 스마트폰 (9:16 기준, ≤ ~7인치)
- **Tablet:** 태블릿 (4:3 ~ 16:10, ≥ ~8인치)

### Mobile Layout
- 중앙 집중 연출
- 조작/정보는 엄지 범위 우선
- Display Layer 요소 최소화

### Tablet Layout
- 좌우 여백 적극 활용
- 천사상/연출 상시 노출 가능
- System UI 분산 배치

**Canvas는 항상 동일한 월드 비율을 유지한다.**
남는 공간은 UI/연출에만 사용한다.
레이아웃 분기는 CSS + JS 디바이스 판별로 처리한다.

---

## 5. 뷰포트 및 레이아웃 시스템

### CSS 리셋 (필수)

```css
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overscroll-behavior: none;
}
```

**모바일 Safari 대응은 CSS에서 50%다.**

### 비율 고정
- 9:16 종횡비를 강제하는 `aspect-ratio` 컨테이너 사용

### Canvas Scaling
- 논리 해상도는 고정하고 CSS로 리사이징
- 기기 성능 저하 방지

### Centering
- 패드 등 넓은 화면에서는 게임 화면을 정중앙에 배치
- 배경(심연/어둠)으로 여백 처리

### Touch Coordinate
- `getBoundingClientRect()`를 활용해 캔버스 스케일링에 따른 터치 좌표 오차 자동 보정

### Canvas Resize 책임
- `index.ts`에서 `resizeCanvas()` 함수가 책임진다
- window resize 이벤트에서 호출

---

## 6. 좌표 및 발판 시스템

모든 좌표는 **절대 px가 아닌 비율 기반**으로 계산한다.

현재 사용 중인 **3x2 발판 좌표계**는:
- 프로토타입 전용
- 향후 비행 궤적 / 장애물 시스템 도입 시 폐기 가능

**레이아웃 로직은 항상 교체 가능해야 한다.**

---

## 7. 시나리오 시스템 원칙

시나리오는 **데이터 기반(sequence)**으로 구성한다.

**ScenarioManager는 상태 머신이 아니다.**
분기와 선택지는 튜토리얼 이후에만 도입한다.

텍스트는 스킵 가능해야 하며, **연출이 본체**다.

### 튜토리얼 시퀀스
- 시퀀스 A: 해변 오프닝 (갈매기 소리 + 독백)
- 시퀀스 B: 부실 전경 및 입부 희망자 등장
- 시퀀스 C: 흡혈귀 소녀의 엉성한 비행 (3x2 보드 튜토리얼)

---

## 8. 오디오 아키텍처

Web Audio API 기반 전역 AudioManager 사용.

### 채널 분리
- BGM
- SFX (Combat)
- UI / System
- Ambient / Environment

### 동시 발음 제한
동일 SFX의 동시 재생은 제한하거나 감쇄한다.

### 모바일 필수 규칙

**AudioContext는 반드시 사용자 입력 후 resume()한다.**

```typescript
async resume() {
    if (this.context.state === 'suspended') {
        await this.context.resume();
    }
}
```

터치 이벤트에서 무조건 호출해야 한다.

**BGM은 재사용하지 않고 항상 새 AudioBufferSourceNode로 교체한다.**

---

## 9. 구현 태도 (AI 행동 지침)

- 과도한 일반화 금지 (범용 엔진 만들지 말 것)
- "나중에 필요할 것"을 이유로 시스템을 확장하지 말 것
- 현재 단계에서 보이지 않는 기능은 구현하지 않는다
- **코드보다 연출 결과가 우선이다**

---

## 10. 성공 기준 (Prototype Success Condition)

모바일 기기에서:
- 화면이 꽉 차고
- 터치 후 즉시 반응하며
- 연출과 사운드가 자연스럽게 이어질 것

**"아, 공기가 있다"는 느낌이 들면 성공이다.**

---

## 부록: 기술 스택 요약

- **3D Engine:** Babylon.js (2.5D 세로 뷰, AdvancedDynamicTexture UI)
- **Viewport:** 100dvh, Safe Area 대응 (2025 Safari 표준)
- **Layers:** L0(Babylon.js 3D 씬), L1(시나리오/천사상), L2(시스템 UI)
- **Audio:** Web Audio API (BGM/SFX 채널 분리 + Limiter)
- **TypeScript:** 100% Strict 모드
- **알고리즘:** Dijkstra 최적 경로 탐색
